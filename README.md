[bookings_raw_json.csv](https://github.com/user-attachments/files/23052835/bookings_raw_json.csv)# Omio Bookings Data Pipeline: Complete Walkthrough

Hey team, here is the complete summary of the bookings data project. We built a robust Star Schema to transform the nested daily export into reliable, analyst-ready data.

## 1. Project Architecture and Setup

I implemented a comprehensive transformation pipeline centered on dbt for the entire workflow.

### Project Steps Taken

1.  Created the dbt project, linked it to BigQuery, and set up version control on GitHub.
2.  Used an artificial file to simulate the semi-structured booking export, loading it to BigQuery to act as our core base source.
   [Uploading bookings_rbookingid,raw_json,uploaded_at
5081011a-8f4d-4066-94de-14e9d371166a,"{""bookingid"": ""5081011a-8f4d-4066-94de-14e9d371166a"", ""createdAt"": ""2025-10-06T11:01:00"", ""updatedAt"": ""2025-10-06T16:15:00"", ""userSelectedCurrency"": ""USD"", ""partnerIdOffer"": ""partner_2"", ""segments"": [{""segmentid"": ""23e69fb7-3f9e-449c-8887-a037e075d6fb"", ""bookingid"": ""5081011a-8f4d-4066-94de-14e9d371166a"", ""carriername"": ""Air France"", ""departuredatetime"": ""2025-10-03T05:17:00"", ""arrivaldatetime"": ""2025-10-07T05:41:00"", ""travelmode"": ""flight""}, {""segmentid"": ""02d52e40-00d6-4d2c-b587-b01ee048f77a"", ""bookingid"": ""5081011a-8f4d-4066-94de-14e9d371166a"", ""carriername"": ""Ryanair"", ""departuredatetime"": ""2025-10-06T13:34:00"", ""arrivaldatetime"": ""2025-10-06T15:10:00"", ""travelmode"": ""bus""}], ""passengers"": [{""passengerId"": ""aafb62e4-2151-4764-9455-6dd38d504544"", ""bookingid"": ""5081011a-8f4d-4066-94de-14e9d371166a"", ""type"": ""infant""}, {""passengerId"": ""28c134ba-c51e-4b48-80e0-701b926277fa"", ""bookingid"": ""5081011a-8f4d-4066-94de-14e9d371166a"", ""type"": ""child""}], ""tickets"": [{""ticketid"": ""4a7a1e4c-2f7c-49f8-8b4d-417b5f2bb8d9"", ""bookingid"": ""5081011a-8f4d-4066-94de-14e9d371166a"", ""bookingPrice"": 146.41, ""bookingCurrency"": ""USD"", ""vendorCode"": ""UA"", ""segments"": [{""segmentid"": ""02d52e40-00d6-4d2c-b587-b01ee048f77a"", ""bookingid"": ""5081011a-8f4d-4066-94de-14e9d371166a"", ""carriername"": ""Ryanair"", ""departuredatetime"": ""2025-10-06T13:34:00"", ""arrivaldatetime"": ""2025-10-06T15:10:00"", ""travelmode"": ""bus""}], ""passengers"": [{""passengerId"": ""aafb62e4-2151-4764-9455-6dd38d504544"", ""bookingid"": ""5081011a-8f4d-4066-94de-14e9d371166a"", ""type"": ""infant""}, {""passengerId"": ""28c134ba-c51e-4b48-80e0-701b926277fa"", ""bookingid"": ""5081011a-8f4d-4066-94de-14e9d371166a"", ""type"": ""child""}]}, {""ticketid"": ""84181605-d764-47a4-8a14-56e8190b1e38"", ""bookingid"": ""5081011a-8f4d-4066-94de-14e9d371166a"", ""bookingPrice"": 470.98, ""bookingCurrency"": ""JPY"", ""vendorCode"": ""DB"", ""segments"": [{""segmentid"": ""23e69fb7-3f9e-449c-8887-a037e075d6fb"", ""bookingid"": ""5081011a-8f4d-4066-94de-14e9d371166a"", ""carriername"": ""Air France"", ""departuredatetime"": ""2025-10-03T05:17:00"", ""arrivaldatetime"": ""2025-10-07T05:41:00"", ""travelmode"": ""flight""}], ""passengers"": [{""passengerId"": ""aafb62e4-2151-4764-9455-6dd38d504544"", ""bookingid"": ""5081011a-8f4d-4066-94de-14e9d371166a"", ""type"": ""infant""}, {""passengerId"": ""28c134ba-c51e-4b48-80e0-701b926277fa"", ""bookingid"": ""5081011a-8f4d-4066-94de-14e9d371166a"", ""type"": ""child""}]}]}",2025-10-18T17:02:12
c38f2543-edd8-4067-b9e4-abf664ecc7e6,"{""bookingid"": ""c38f2543-edd8-4067-b9e4-abf664ecc7e6"", ""createdAt"": ""2025-10-06T11:43:00"", ""updatedAt"": ""2025-10-07T01:05:00"", ""userSelectedCurrency"": ""JPY"", ""partnerIdOffer"": ""partner_1"", ""segments"": [{""segmentid"": ""24e1b3ae-a70b-4e92-9999-813e61228f03"", ""bookingid"": ""c38f2543-edd8-4067-b9e4-abf664ecc7e6"", ""carriername"": ""Air France"", ""departuredatetime"": ""2025-10-07T06:35:00"", ""arrivaldatetime"": ""2025-10-03T05:20:00"", ""travelmode"": ""flight""}, {""segmentid"": ""a75f4bdc-1641-4fcb-a168-ab492c08270a"", ""bookingid"": ""c38f2543-edd8-4067-b9e4-abf664ecc7e6"", ""carriername"": ""Deutsche Bahn"", ""departuredatetime"": ""2025-10-01T18:25:00"", ""arrivaldatetime"": ""2025-10-03T10:13:00"", ""travelmode"": ""ferry""}], ""passengers"": [{""passengerId"": ""5b595c74-bf60-46a4-97b6-953fbe5ff150"", ""bookingid"": ""c38f2543-edd8-4067-b9e4-abf664ecc7e6"", ""type"": ""adult""}], ""tickets"": [{""ticketid"": ""83c23210-0837-4947-ae1a-956d6489f6f2"", ""bookingid"": ""c38f2543-edd8-4067-b9e4-abf664ecc7e6"", ""bookingPrice"": 413.37, ""bookingCurrency"": ""USD"", ""vendorCode"": ""LH"", ""segments"": [{""segmentid"": ""24e1b3ae-a70b-4e92-9999-813e61228f03"", ""bookingid"": ""c38f2543-edd8-4067-b9e4-abf664ecc7e6"", ""carriername"": ""Air France"", ""departuredatetime"": ""2025-10-07T06:35:00"", ""arrivaldatetime"": ""2025-10-03T05:20:00"", ""travelmode"": ""flight""}, {""segmentid"": ""a75f4bdc-1641-4fcb-a168-ab492c08270a"", ""bookingid"": ""c38f2543-edd8-4067-b9e4-abf664ecc7e6"", ""carriername"": ""Deutsche Bahn"", ""departuredatetime"": ""2025-10-01T18:25:00"", ""arrivaldatetime"": ""2025-10-03T10:13:00"", ""travelmode"": ""ferry""}], ""passengers"": [{""passengerId"": ""5b595c74-bf60-46a4-97b6-953fbe5ff150"", ""bookingid"": ""c38f2543-edd8-4067-b9e4-abf664ecc7e6"", ""type"": ""adult""}]}, {""ticketid"": ""9e46d29b-f889-492a-adfb-b41e5cc54a27"", ""bookingid"": ""c38f2543-edd8-4067-b9e4-abf664ecc7e6"", ""bookingPrice"": 93.62, ""bookingCurrency"": ""JPY"", ""vendorCode"": ""AF"", ""segments"": [{""segmentid"": ""24e1b3ae-a70b-4e92-9999-813e61228f03"", ""bookingid"": ""c38f2543-edd8-4067-b9e4-abf664ecc7e6"", ""carriername"": ""Air France"", ""departuredatetime"": ""2025-10-07T06:35:00"", ""arrivaldatetime"": ""2025-10-03T05:20:00"", ""travelmode"": ""flight""}], ""passengers"": [{""passengerId"": ""5b595c74-bf60-46a4-97b6-953fbe5ff150"", ""bookingid"": ""c38f2543-edd8-4067-b9e4-abf664ecc7e6"", ""type"": ""adult""}]}]}",2025-10-18T17:02:12
e4fe393b-0b9b-4493-a4ab-1733fd5284c3,"{""bookingid"": ""e4fe393b-0b9b-4493-a4ab-1733fd5284c3"", ""createdAt"": ""2025-10-01T10:13:00"", ""updatedAt"": ""2025-10-03T00:38:00"", ""userSelectedCurrency"": ""EUR"", ""partnerIdOffer"": ""partner_5"", ""segments"": [{""segmentid"": ""85beaa18-7519-4534-b06a-965f696cc283"", ""bookingid"": ""e4fe393b-0b9b-4493-a4ab-1733fd5284c3"", ""carriername"": ""United Airlines"", ""departuredatetime"": ""2025-10-04T20:56:00"", ""arrivaldatetime"": ""2025-10-06T22:09:00"", ""travelmode"": ""ferry""}], ""passengers"": [{""passengerId"": ""8336e7b4-2194-4248-8e2c-bec6d8cee3e6"", ""bookingid"": ""e4fe393b-0b9b-4493-a4ab-1733fd5284c3"", ""type"": ""adult""}], ""tickets"": [{""ticketid"": ""25f74469-3f72-46e0-91c7-e0bc9cecbf7c"", ""bookingid"": ""e4fe393b-0b9b-4493-a4ab-1733fd5284c3"", ""bookingPrice"": 235.0, ""bookingCurrency"": ""EUR"", ""vendorCode"": ""UA"", ""segments"": [{""segmentid"": ""85beaa18-7519-4534-b06a-965f696cc283"", ""bookingid"": ""e4fe393b-0b9b-4493-a4ab-1733fd5284c3"", ""carriername"": ""United Airlines"", ""departuredatetime"": ""2025-10-04T20:56:00"", ""arrivaldatetime"": ""2025-10-06T22:09:00"", ""travelmode"": ""ferry""}], ""passengers"": [{""passengerId"": ""8336e7b4-2194-4248-8e2c-bec6d8cee3e6"", ""bookingid"": ""e4fe393b-0b9b-4493-a4ab-1733fd5284c3"", ""type"": ""adult""}]}, {""ticketid"": ""6b3967b4-dd86-47f3-b3f2-bc74d72b2edf"", ""bookingid"": ""e4fe393b-0b9b-4493-a4ab-1733fd5284c3"", ""bookingPrice"": 344.05, ""bookingCurrency"": ""EUR"", ""vendorCode"": ""LH"", ""segments"": [{""segmentid"": ""85beaa18-7519-4534-b06a-965f696cc283"", ""bookingid"": ""e4fe393b-0b9b-4493-a4ab-1733fd5284c3"", ""carriername"": ""United Airlines"", ""departuredatetime"": ""2025-10-04T20:56:00"", ""arrivaldatetime"": ""2025-10-06T22:09:00"", ""travelmode"": ""ferry""}], ""passengers"": [{""passengerId"": ""8336e7b4-2194-4248-8e2c-bec6d8cee3e6"", ""bookingid"": ""e4fe393b-0b9b-4493-a4ab-1733fd5284c3"", ""type"": ""adult""}]}]}",2025-10-18T17:02:12
e8806a7e-3b87-4c89-bde5-8873231e4665,"{""bookingid"": ""e8806a7e-3b87-4c89-bde5-8873231e4665"", ""createdAt"": ""2025-10-03T06:41:00"", ""updatedAt"": ""2025-10-07T01:26:00"", ""userSelectedCurrency"": ""USD"", ""partnerIdOffer"": ""partner_4"", ""segments"": [{""segmentid"": ""74509961-df68-423d-96da-206960d6c032"", ""bookingid"": ""e8806a7e-3b87-4c89-bde5-8873231e4665"", ""carriername"": ""Deutsche Bahn"", ""departuredatetime"": ""2025-10-07T01:34:00"", ""arrivaldatetime"": ""2025-10-04T07:37:00"", ""travelmode"": ""bus""}], ""passengers"": [{""passengerId"": ""5fa55faf-556e-4d79-960d-7e9a54c7770c"", ""bookingid"": ""e8806a7e-3b87-4c89-bde5-8873231e4665"", ""type"": ""adult""}, {""passengerId"": ""3b5056e1-d891-4083-8b33-1c578dfbf194"", ""bookingid"": ""e8806a7e-3b87-4c89-bde5-8873231e4665"", ""type"": ""infant""}], ""tickets"": [{""ticketid"": ""27f537a9-5209-42d7-9837-19230bb12ea8"", ""bookingid"": ""e8806a7e-3b87-4c89-bde5-8873231e4665"", ""bookingPrice"": 377.7, ""bookingCurrency"": ""EUR"", ""vendorCode"": ""DB"", ""segments"": [{""segmentid"": ""74509961-df68-423d-96da-206960d6c032"", ""bookingid"": ""e8806a7e-3b87-4c89-bde5-8873231e4665"", ""carriername"": ""Deutsche Bahn"", ""departuredatetime"": ""2025-10-07T01:34:00"", ""arrivaldatetime"": ""2025-10-04T07:37:00"", ""travelmode"": ""bus""}], ""passengers"": [{""passengerId"": ""5fa55faf-556e-4d79-960d-7e9a54c7770c"", ""bookingid"": ""e8806a7e-3b87-4c89-bde5-8873231e4665"", ""type"": ""adult""}]}, {""ticketid"": ""ea50d7ae-732b-4799-b18a-4012943f59e1"", ""bookingid"": ""e8806a7e-3b87-4c89-bde5-8873231e4665"", ""bookingPrice"": 136.22, ""bookingCurrency"": ""JPY"", ""vendorCode"": ""DB"", ""segments"": [{""segmentid"": ""74509961-df68-423d-96da-206960d6c032"", ""bookingid"": ""e8806a7e-3b87-4c89-bde5-8873231e4665"", ""carriername"": ""Deutsche Bahn"", ""departuredatetime"": ""2025-10-07T01:34:00"", ""arrivaldatetime"": ""2025-10-04T07:37:00"", ""travelmode"": ""bus""}], ""passengers"": [{""passengerId"": ""5fa55faf-556e-4d79-960d-7e9a54c7770c"", ""bookingid"": ""e8806a7e-3b87-4c89-bde5-8873231e4665"", ""type"": ""adult""}, {""passengerId"": ""3b5056e1-d891-4083-8b33-1c578dfbf194"", ""bookingid"": ""e8806a7e-3b87-4c89-bde5-8873231e4665"", ""type"": ""infant""}]}]}",2025-10-18T17:02:12
eac705c2-0746-4582-b34e-c49843c8ec70,"{""bookingid"": ""eac705c2-0746-4582-b34e-c49843c8ec70"", ""createdAt"": ""2025-10-05T16:51:00"", ""updatedAt"": ""2025-10-01T13:44:00"", ""userSelectedCurrency"": ""JPY"", ""partnerIdOffer"": ""partner_3"", ""segments"": [{""segmentid"": ""6edfe77c-d0e0-49bb-84db-9310a7f8dd50"", ""bookingid"": ""eac705c2-0746-4582-b34e-c49843c8ec70"", ""carriername"": ""British Airways"", ""departuredatetime"": ""2025-10-03T15:08:00"", ""arrivaldatetime"": ""2025-10-05T23:05:00"", ""travelmode"": ""flight""}, {""segmentid"": ""e71ce32c-bd39-4357-880e-b8670a58ba43"", ""bookingid"": ""eac705c2-0746-4582-b34e-c49843c8ec70"", ""carriername"": ""Lufthansa"", ""departuredatetime"": ""2025-10-03T04:10:00"", ""arrivaldatetime"": ""2025-10-06T21:38:00"", ""travelmode"": ""flight""}, {""segmentid"": ""bd85fc23-6875-4148-91bd-e7b0cb716c52"", ""bookingid"": ""eac705c2-0746-4582-b34e-c49843c8ec70"", ""carriername"": ""British Airways"", ""departuredatetime"": ""2025-10-05T03:29:00"", ""arrivaldatetime"": ""2025-10-05T16:35:00"", ""travelmode"": ""flight""}], ""passengers"": [{""passengerId"": ""6d7cd32d-f762-45d8-b917-a3f2db89ecfa"", ""bookingid"": ""eac705c2-0746-4582-b34e-c49843c8ec70"", ""type"": ""adult""}, {""passengerId"": ""e2cf7b8e-ef10-4054-8f8c-51909284c5dc"", ""bookingid"": ""eac705c2-0746-4582-b34e-c49843c8ec70"", ""type"": ""infant""}, {""passengerId"": ""fb1df2ea-a669-4a97-be4a-41fb66317050"", ""bookingid"": ""eac705c2-0746-4582-b34e-c49843c8ec70"", ""type"": ""adult""}], ""tickets"": [{""ticketid"": ""15caa800-72ee-4334-8a4a-634ab1aceed4"", ""bookingid"": ""eac705c2-0746-4582-b34e-c49843c8ec70"", ""bookingPrice"": 132.57, ""bookingCurrency"": ""JPY"", ""vendorCode"": ""DB"", ""segments"": [{""segmentid"": ""e71ce32c-bd39-4357-880e-b8670a58ba43"", ""bookingid"": ""eac705c2-0746-4582-b34e-c49843c8ec70"", ""carriername"": ""Lufthansa"", ""departuredatetime"": ""2025-10-03T04:10:00"", ""arrivaldatetime"": ""2025-10-06T21:38:00"", ""travelmode"": ""flight""}, {""segmentid"": ""bd85fc23-6875-4148-91bd-e7b0cb716c52"", ""bookingid"": ""eac705c2-0746-4582-b34e-c49843c8ec70"", ""carriername"": ""British Airways"", ""departuredatetime"": ""2025-10-05T03:29:00"", ""arrivaldatetime"": ""2025-10-05T16:35:00"", ""travelmode"": ""flight""}], ""passengers"": [{""passengerId"": ""6d7cd32d-f762-45d8-b917-a3f2db89ecfa"", ""bookingid"": ""eac705c2-0746-4582-b34e-c49843c8ec70"", ""type"": ""adult""}, {""passengerId"": ""e2cf7b8e-ef10-4054-8f8c-51909284c5dc"", ""bookingid"": ""eac705c2-0746-4582-b34e-c49843c8ec70"", ""type"": ""infant""}, {""passengerId"": ""fb1df2ea-a669-4a97-be4a-41fb66317050"", ""bookingid"": ""eac705c2-0746-4582-b34e-c49843c8ec70"", ""type"": ""adult""}]}, {""ticketid"": ""792f777d-830b-46e7-ad58-d095ec782bae"", ""bookingid"": ""eac705c2-0746-4582-b34e-c49843c8ec70"", ""bookingPrice"": 443.52, ""bookingCurrency"": ""EUR"", ""vendorCode"": ""BA"", ""segments"": [{""segmentid"": ""6edfe77c-d0e0-49bb-84db-9310a7f8dd50"", ""bookingid"": ""eac705c2-0746-4582-b34e-c49843c8ec70"", ""carriername"": ""British Airways"", ""departuredatetime"": ""2025-10-03T15:08:00"", ""arrivaldatetime"": ""2025-10-05T23:05:00"", ""travelmode"": ""flight""}, {""segmentid"": ""e71ce32c-bd39-4357-880e-b8670a58ba43"", ""bookingid"": ""eac705c2-0746-4582-b34e-c49843c8ec70"", ""carriername"": ""Lufthansa"", ""departuredatetime"": ""2025-10-03T04:10:00"", ""arrivaldatetime"": ""2025-10-06T21:38:00"", ""travelmode"": ""flight""}], ""passengers"": [{""passengerId"": ""6d7cd32d-f762-45d8-b917-a3f2db89ecfa"", ""bookingid"": ""eac705c2-0746-4582-b34e-c49843c8ec70"", ""type"": ""adult""}, {""passengerId"": ""e2cf7b8e-ef10-4054-8f8c-51909284c5dc"", ""bookingid"": ""eac705c2-0746-4582-b34e-c49843c8ec70"", ""type"": ""infant""}, {""passengerId"": ""fb1df2ea-a669-4a97-be4a-41fb66317050"", ""bookingid"": ""eac705c2-0746-4582-b34e-c49843c8ec70"", ""type"": ""adult""}]}]}",2025-10-18T17:02:12
673181ed-da24-4435-a217-ef95f04beb32,"{""bookingid"": ""673181ed-da24-4435-a217-ef95f04beb32"", ""createdAt"": ""2025-10-03T12:13:00"", ""updatedAt"": ""2025-10-03T11:05:00"", ""userSelectedCurrency"": ""JPY"", ""partnerIdOffer"": ""partner_1"", ""segments"": [{""segmentid"": ""ea1ea82d-a44d-47e8-9ae7-9f5e5b328320"", ""bookingid"": ""673181ed-da24-4435-a217-ef95f04beb32"", ""carriername"": ""United Airlines"", ""departuredatetime"": ""2025-10-02T05:56:00"", ""arrivaldatetime"": ""2025-10-05T16:49:00"", ""travelmode"": ""ferry""}, {""segmentid"": ""845378c8-885f-42b3-b4a6-642eed88d06f"", ""bookingid"": ""673181ed-da24-4435-a217-ef95f04beb32"", ""carriername"": ""Lufthansa"", ""departuredatetime"": ""2025-10-03T21:10:00"", ""arrivaldatetime"": ""2025-10-04T08:46:00"", ""travelmode"": ""ferry""}, {""segmentid"": ""ed32c382-0502-42ac-aacb-f1460f4de49d"", ""bookingid"": ""673181ed-da24-4435-a217-ef95f04beb32"", ""carriername"": ""Ryanair"", ""departuredatetime"": ""2025-10-03T00:58:00"", ""arrivaldatetime"": ""2025-10-02T04:19:00"", ""travelmode"": ""train""}], ""passengers"": [{""passengerId"": ""544c3987-5d41-4d54-aa31-4660c8c38355"", ""bookingid"": ""673181ed-da24-4435-a217-ef95f04beb32"", ""type"": ""adult""}], ""tickets"": [{""ticketid"": ""f49105ea-76e3-4ee2-b09c-623d253b09f1"", ""bookingid"": ""673181ed-da24-4435-a217-ef95f04beb32"", ""bookingPrice"": 72.76, ""bookingCurrency"": ""EUR"", ""vendorCode"": ""LH"", ""segments"": [{""segmentid"": ""845378c8-885f-42b3-b4a6-642eed88d06f"", ""bookingid"": ""673181ed-da24-4435-a217-ef95f04beb32"", ""carriername"": ""Lufthansa"", ""departuredatetime"": ""2025-10-03T21:10:00"", ""arrivaldatetime"": ""2025-10-04T08:46:00"", ""travelmode"": ""ferry""}], ""passengers"": [{""passengerId"": ""544c3987-5d41-4d54-aa31-4660c8c38355"", ""bookingid"": ""673181ed-da24-4435-a217-ef95f04beb32"", ""type"": ""adult""}]}]}",2025-10-18T17:02:12
2bde7f4e-5445-4f39-8fb9-a1fa9e5257b1,"{""bookingid"": ""2bde7f4e-5445-4f39-8fb9-a1fa9e5257b1"", ""createdAt"": ""2025-10-03T19:38:00"", ""updatedAt"": ""2025-10-03T09:46:00"", ""userSelectedCurrency"": ""JPY"", ""partnerIdOffer"": ""partner_5"", ""segments"": [{""segmentid"": ""c0d0b1d2-8bbe-4b06-aa58-05af028b98b6"", ""bookingid"": ""2bde7f4e-5445-4f39-8fb9-a1fa9e5257b1"", ""carriername"": ""Air France"", ""departuredatetime"": ""2025-10-03T01:49:00"", ""arrivaldatetime"": ""2025-10-05T08:38:00"", ""travelmode"": ""ferry""}], ""passengers"": [{""passengerId"": ""ed8bfea1-349a-4d92-805b-652bd965e1a2"", ""bookingid"": ""2bde7f4e-5445-4f39-8fb9-a1fa9e5257b1"", ""type"": ""infant""}, {""passengerId"": ""e322388b-fb4a-441d-a221-86cc5e8b3466"", ""bookingid"": ""2bde7f4e-5445-4f39-8fb9-a1fa9e5257b1"", ""type"": ""adult""}, {""passengerId"": ""0643222b-97dc-4469-824d-15561261e443"", ""bookingid"": ""2bde7f4e-5445-4f39-8fb9-a1fa9e5257b1"", ""type"": ""adult""}], ""tickets"": [{""ticketid"": ""a08cd158-97e6-483e-b35d-f3430c95e29c"", ""bookingid"": ""2bde7f4e-5445-4f39-8fb9-a1fa9e5257b1"", ""bookingPrice"": 124.84, ""bookingCurrency"": ""JPY"", ""vendorCode"": ""BA"", ""segments"": [{""segmentid"": ""c0d0b1d2-8bbe-4b06-aa58-05af028b98b6"", ""bookingid"": ""2bde7f4e-5445-4f39-8fb9-a1fa9e5257b1"", ""carriername"": ""Air France"", ""departuredatetime"": ""2025-10-03T01:49:00"", ""arrivaldatetime"": ""2025-10-05T08:38:00"", ""travelmode"": ""ferry""}], ""passengers"": [{""passengerId"": ""ed8bfea1-349a-4d92-805b-652bd965e1a2"", ""bookingid"": ""2bde7f4e-5445-4f39-8fb9-a1fa9e5257b1"", ""type"": ""infant""}, {""passengerId"": ""0643222b-97dc-4469-824d-15561261e443"", ""bookingid"": ""2bde7f4e-5445-4f39-8fb9-a1fa9e5257b1"", ""type"": ""adult""}]}]}",2025-10-18T17:02:12
a8c032e8-b38d-45ce-8810-19c37dda88e7,"{""bookingid"": ""a8c032e8-b38d-45ce-8810-19c37dda88e7"", ""createdAt"": ""2025-10-01T20:05:00"", ""updatedAt"": ""2025-10-05T17:53:00"", ""userSelectedCurrency"": ""GBP"", ""partnerIdOffer"": ""partner_5"", ""segments"": [{""segmentid"": ""1b85eb7d-1d4b-4d3e-945b-dc5a2f867612"", ""bookingid"": ""a8c032e8-b38d-45ce-8810-19c37dda88e7"", ""carriername"": ""Lufthansa"", ""departuredatetime"": ""2025-10-01T19:56:00"", ""arrivaldatetime"": ""2025-10-03T15:03:00"", ""travelmode"": ""train""}, {""segmentid"": ""fe9f51f4-4ebe-4606-a478-4b069be7880e"", ""bookingid"": ""a8c032e8-b38d-45ce-8810-19c37dda88e7"", ""carriername"": ""Ryanair"", ""departuredatetime"": ""2025-10-01T10:46:00"", ""arrivaldatetime"": ""2025-10-04T10:48:00"", ""travelmode"": ""train""}], ""passengers"": [{""passengerId"": ""6afb8b84-d21a-4489-a042-67e8aa1ced8c"", ""bookingid"": ""a8c032e8-b38d-45ce-8810-19c37dda88e7"", ""type"": ""adult""}], ""tickets"": [{""ticketid"": ""19ec5ed5-d5bf-4092-a971-95f69294f730"", ""bookingid"": ""a8c032e8-b38d-45ce-8810-19c37dda88e7"", ""bookingPrice"": 439.09, ""bookingCurrency"": ""EUR"", ""vendorCode"": ""DB"", ""segments"": [{""segmentid"": ""1b85eb7d-1d4b-4d3e-945b-dc5a2f867612"", ""bookingid"": ""a8c032e8-b38d-45ce-8810-19c37dda88e7"", ""carriername"": ""Lufthansa"", ""departuredatetime"": ""2025-10-01T19:56:00"", ""arrivaldatetime"": ""2025-10-03T15:03:00"", ""travelmode"": ""train""}, {""segmentid"": ""fe9f51f4-4ebe-4606-a478-4b069be7880e"", ""bookingid"": ""a8c032e8-b38d-45ce-8810-19c37dda88e7"", ""carriername"": ""Ryanair"", ""departuredatetime"": ""2025-10-01T10:46:00"", ""arrivaldatetime"": ""2025-10-04T10:48:00"", ""travelmode"": ""train""}], ""passengers"": [{""passengerId"": ""6afb8b84-d21a-4489-a042-67e8aa1ced8c"", ""bookingid"": ""a8c032e8-b38d-45ce-8810-19c37dda88e7"", ""type"": ""adult""}]}]}",2025-10-18T17:02:12
4cc732b4-df65-4c16-a84e-dc7764d3900b,"{""bookingid"": ""4cc732b4-df65-4c16-a84e-dc7764d3900b"", ""createdAt"": ""2025-10-03T06:04:00"", ""updatedAt"": ""2025-10-02T05:14:00"", ""userSelectedCurrency"": ""GBP"", ""partnerIdOffer"": ""partner_1"", ""segments"": [{""segmentid"": ""54631344-4362-45da-a5df-1fe80540dbde"", ""bookingid"": ""4cc732b4-df65-4c16-a84e-dc7764d3900b"", ""carriername"": ""United Airlines"", ""departuredatetime"": ""2025-10-05T01:10:00"", ""arrivaldatetime"": ""2025-10-04T00:55:00"", ""travelmode"": ""bus""}], ""passengers"": [{""passengerId"": ""6d320729-5678-475f-8319-3441f2f2646a"", ""bookingid"": ""4cc732b4-df65-4c16-a84e-dc7764d3900b"", ""type"": ""adult""}, {""passengerId"": ""e618cc3c-759f-4e5c-bb0e-abffac796cc6"", ""bookingid"": ""4cc732b4-df65-4c16-a84e-dc7764d3900b"", ""type"": ""infant""}], ""tickets"": [{""ticketid"": ""7e72a801-e1fe-494d-a516-381e8a48b226"", ""bookingid"": ""4cc732b4-df65-4c16-a84e-dc7764d3900b"", ""bookingPrice"": 50.97, ""bookingCurrency"": ""JPY"", ""vendorCode"": ""AF"", ""segments"": [{""segmentid"": ""54631344-4362-45da-a5df-1fe80540dbde"", ""bookingid"": ""4cc732b4-df65-4c16-a84e-dc7764d3900b"", ""carriername"": ""United Airlines"", ""departuredatetime"": ""2025-10-05T01:10:00"", ""arrivaldatetime"": ""2025-10-04T00:55:00"", ""travelmode"": ""bus""}], ""passengers"": [{""passengerId"": ""6d320729-5678-475f-8319-3441f2f2646a"", ""bookingid"": ""4cc732b4-df65-4c16-a84e-dc7764d3900b"", ""type"": ""adult""}, {""passengerId"": ""e618cc3c-759f-4e5c-bb0e-abffac796cc6"", ""bookingid"": ""4cc732b4-df65-4c16-a84e-dc7764d3900b"", ""type"": ""infant""}]}, {""ticketid"": ""b8102035-44a9-473e-9254-6cca35acf0aa"", ""bookingid"": ""4cc732b4-df65-4c16-a84e-dc7764d3900b"", ""bookingPrice"": 466.93, ""bookingCurrency"": ""JPY"", ""vendorCode"": ""AF"", ""segments"": [{""segmentid"": ""54631344-4362-45da-a5df-1fe80540dbde"", ""bookingid"": ""4cc732b4-df65-4c16-a84e-dc7764d3900b"", ""carriername"": ""United Airlines"", ""departuredatetime"": ""2025-10-05T01:10:00"", ""arrivaldatetime"": ""2025-10-04T00:55:00"", ""travelmode"": ""bus""}], ""passengers"": [{""passengerId"": ""6d320729-5678-475f-8319-3441f2f2646a"", ""bookingid"": ""4cc732b4-df65-4c16-a84e-dc7764d3900b"", ""type"": ""adult""}, {""passengerId"": ""e618cc3c-759f-4e5c-bb0e-abffac796cc6"", ""bookingid"": ""4cc732b4-df65-4c16-a84e-dc7764d3900b"", ""type"": ""infant""}]}]}",2025-10-18T17:02:12
84a80f6f-3337-4b9d-9932-ff3164be4697,"{""bookingid"": ""84a80f6f-3337-4b9d-9932-ff3164be4697"", ""createdAt"": ""2025-10-02T11:24:00"", ""updatedAt"": ""2025-10-03T22:40:00"", ""userSelectedCurrency"": ""GBP"", ""partnerIdOffer"": ""partner_2"", ""segments"": [{""segmentid"": ""800fc21e-7532-4c14-9756-101edaa1b222"", ""bookingid"": ""84a80f6f-3337-4b9d-9932-ff3164be4697"", ""carriername"": ""Ryanair"", ""departuredatetime"": ""2025-10-07T06:12:00"", ""arrivaldatetime"": ""2025-10-06T17:25:00"", ""travelmode"": ""ferry""}], ""passengers"": [{""passengerId"": ""1cbd38dd-a25a-433c-bebf-3024cc04e55b"", ""bookingid"": ""84a80f6f-3337-4b9d-9932-ff3164be4697"", ""type"": ""child""}], ""tickets"": [{""ticketid"": ""48bb9394-a423-4ed3-af23-82fcc2d79f5a"", ""bookingid"": ""84a80f6f-3337-4b9d-9932-ff3164be4697"", ""bookingPrice"": 363.47, ""bookingCurrency"": ""JPY"", ""vendorCode"": ""DB"", ""segments"": [{""segmentid"": ""800fc21e-7532-4c14-9756-101edaa1b222"", ""bookingid"": ""84a80f6f-3337-4b9d-9932-ff3164be4697"", ""carriername"": ""Ryanair"", ""departuredatetime"": ""2025-10-07T06:12:00"", ""arrivaldatetime"": ""2025-10-06T17:25:00"", ""travelmode"": ""ferry""}], ""passengers"": [{""passengerId"": ""1cbd38dd-a25a-433c-bebf-3024cc04e55b"", ""bookingid"": ""84a80f6f-3337-4b9d-9932-ff3164be4697"", ""type"": ""child""}]}, {""ticketid"": ""881d060d-a2f7-472a-9e94-1f646a1fe251"", ""bookingid"": ""84a80f6f-3337-4b9d-9932-ff3164be4697"", ""bookingPrice"": 135.45, ""bookingCurrency"": ""USD"", ""vendorCode"": ""LH"", ""segments"": [{""segmentid"": ""800fc21e-7532-4c14-9756-101edaa1b222"", ""bookingid"": ""84a80f6f-3337-4b9d-9932-ff3164be4697"", ""carriername"": ""Ryanair"", ""departuredatetime"": ""2025-10-07T06:12:00"", ""arrivaldatetime"": ""2025-10-06T17:25:00"", ""travelmode"": ""ferry""}], ""passengers"": [{""passengerId"": ""1cbd38dd-a25a-433c-bebf-3024cc04e55b"", ""bookingid"": ""84a80f6f-3337-4b9d-9932-ff3164be4697"", ""type"": ""child""}]}]}",2025-10-18T17:02:12
aw_json.csv…]()

4.  Defined all transformations in dbt (SQL/YAML).
5.  Included a functional example of an Airflow DAG to demonstrate how orchestration, scheduling, and failure logic would work in production.

### Data Flow Diagram Notes


#### Initial ERD of Raw Data: Shows the complexity of the 6 intertwined raw tables before transformation.
<img width="476" height="663" alt="image" src="https://github.com/user-attachments/assets/12d4139a-4a46-43d6-9d75-44c21003853d" />

#### Star Schema of Core Marts: Illustrates the final, simplified analytical structure with the central Fact and surrounding Dimensions/Bridges.
<img width="890" height="442" alt="image" src="https://github.com/user-attachments/assets/ef8f48c1-5033-4486-84aa-dcb929565378" />

#### Lineage from Raw to Reporting: Provides the end-to-end lineage, showing how raw columns flow through Staging, Intermediate, and Marts to become final KPIs.
<img width="1349" height="601" alt="image" src="https://github.com/user-attachments/assets/8a85b2a7-e0b6-464e-a281-04c1ccbe995a" />


---

## 2. Data Model Design (Pure Star Schema)

We chose the Pure Star Schema centered on the Ticket Transaction for maximum performance and stability.

### Key Modeling Decisions

* Fact Grain is the Ticket: We chose the Ticket (`fact_ticket_transaction`) as the Fact grain because the primary measure, `ticket_price_eur`, lives on the ticket level. Booking is correctly modeled as a Dimension (the transaction header).
* Master IDs: We assume `passenger_id` and `segment_id` are Master Keys (persistent). This makes our `dim_passenger` and `dim_segment` tables small, efficient, and robust.
* M:M Resolution (Bridge Tables): We use Bridge Tables (`bridge_ticket_passenger` and `bridge_ticket_segment`) to resolve the Many-to-Many (M:M) relationship between the Fact and the Master Dimensions. This ensures we correctly attribute ticket revenue across multiple linked people and segments.

### Data Model Structure

| Layer | Materialization | Key Example |
| :--- | :--- | :--- |
| Staging (`stg_*`) | View | `stg_backend__booking` (Flattening and cleansing of raw JSON.) |
| Intermediate (`int_*`) | View | `int_ticket_base` (Calculates EUR Conversion and handles Master ID deduplication.) |
| Marts: Core (`fact_`, `dim_`, `bridge_`) |  Incremental | `fact_ticket_transaction` (Set to Incremental using `uploaded_at_timestamp` for efficiency.) |
| Marts: Reporting (`Reporting_`) |  Table | `reporting_tickets_monthly_summary` (Ready for BI data mart) |

### Snapshots (Slowly Changing Data)

We would implement snapshots on the `stg_backend___booking` model, targeting the `updated_at_timestamp` column using the `check` strategy.

---


## 3. Data Quality (DQ) Enforcement

We enforce data quality across the pipeline using a structured framework to guarantee stakeholder trust.

### DQ Testing Philosophy and Placement

Our testing strategy covers the entire data lifecycle, recognizing that each dbt layer introduces different risks.

| Layer | When to Test | Test Focus | Implementation |
| :--- | :--- | :--- | :--- |
| Pre-Transform (Staging) | Immediately upon ingestion. | Initial Validity & Cleansing: We run quick checks to ensure type conformance and basic validity (e.g., price $\ge 0$). Goal is to fail fast. | YAML (`accepted_values`) or `tests//` SQL files. |
| Post-Transform (Marts) | After all joins and aggregations are complete. | Final Integrity & Business Logic: We confirm structural integrity (PKs, FKs) and run complex anomaly checks. | YAML (`unique`, `relationships`) and `tests//` SQL files. |

---

### DQ Question Answers

#### Business vs. Technical Tests, what's the difference?

The core difference lies in the purpose and origin of the requirement:

* Technical tests check the quiality and schema constraints. They ensure the pipeline worked correctly. *Example:* Ensuring `ticket_id` is always unique (defined in YAML).
* Business tests check the data logic and enforce domain rules. They validate that the data makes sense based on real-world constraints. *Example:* "Every booking has $\ge 1$ passenger" (defined in a custom SQL file in `tests//`).

#### How to test for seasonality anomalies like Train strikes?

Anomalies caused by external factors require sophisticated time-aware comparisons.

1.  Year-over-Year (YoY) Baseline: We start by comparing current volume/revenue to the same period last year. This naturally controls for recurring seasonality (e.g., holiday travel spikes).
2.  Z-Score Anomaly Detection: We use the Z-score method to flag statistically significant deviations.
3.  Exclusion Window: For non-recurring events like strikes, the Z-score logic is refined using an Exclusion Window. We write the test logic to exclude all days flagged as "strike days" from the historical mean calculation. This prevents a false comparison that would otherwise trigger an alert against a stable period.

### DQ Implementation Summary

| Test Type | Focus | Location | Implementation Style |
| :--- | :--- | :--- | :--- |
| Technical Tests | Structural Health (PKs, FKs) | YAML (`schema.yml`) in Marts folders. | `unique`, `not_null`, `relationships` (Native dbt tests). |
| Business Logic Tests | Domain Rules (e.g., $\ge 1$ passenger) | `tests/` folder. | Custom `.sql` file that returns rows on failure. |
| Time-Aware Tests | Anomalies (Volume/Price Spikes) | `tests/` folder. | Custom `.sql` file using Z-Score and window functions. |

---


## 4. Pipeline Orchestration Walkthrough (Airflow)

This section explains the provided Airflow DAG, which orchestrates the daily process of transforming raw booking data into final reporting marts.

### Orchestration Context

This DAG is configured to work specifically with dbt Cloud, utilizing the `DbtCloudRunJobOperator`. This approach is common in production because dbt Cloud handles the compute and environment management, letting Airflow focus purely on scheduling and dependency management.

Note: This DAG file is included here as an example of my approach. In a true production environment, the Airflow DAG files would reside in a separate, dedicated Git repository from the dbt project for better separation of concerns and security. If the dbt project were run using dbt Core (CLI), I would replace the `DbtCloudRunJobOperator` with a generic `BashOperator` or a specialized provider (like `dbt-common`) to run commands like `dbt run --target prod`.

### DAG Flow and Logic

The DAG implements the essential "Test Then Deploy" pipeline methodology, ensuring data quality is always verified before production tables are updated.

1.  Ingest Raw Export (`ingest_raw_export`):
    * Action: This task simulates the initial Extract and Load (E&L) step—a separate service (like Fivetran or a custom loader) dumping the latest semi-structured booking data into the raw BigQuery schema.
    * Operator: Uses a simple `BashOperator` as a mock.

2.  Run Staging, Intermediate & Test (`run_staging_build_and_test`):
    * Action: Triggers the first dbt Cloud Job. This job is configured to run all transformations up through the Marts layer and execute all data quality checks (`dbt test`).
    * Failure Logic: This task is the Data Quality Gate. If any model or test fails, the pipeline stops immediately.

3.  Promote to Production (`run_prod_deploy`):
    * Action: Triggers the final dbt Cloud Job, configured to run only the Marts layer models (`dbt run --target production`).
    * Dependency: Uses `trigger_rule="all_success"`. This task only runs if Step 2 successfully passed every data quality check.

4.  Notifications (`default_args` / `notify_success`):
    * Scheduling: The DAG runs daily at 6 AM UTC (`schedule_interval="0 6 * * *"`).
    * Failure: `email_on_failure=True` in `default_args` ensures immediate alerts are sent to the data team if any test or task fails.
    * Retries: The pipeline is configured with 2 retries and a 5-minute delay to gracefully handle transient cloud or network errors.

---

---

## 5. Stakeholder Communication (One-Pager for PMs)


[Booking Reporting Overview.docx](https://github.com/user-attachments/files/23052723/Booking.Reporting.Overview.docx)

## 6. Metrics and KPIs

The KPIs in the final report are chosen not only for strategic importance but also to demonstrate how your fact_ticket_transaction and Bridge Tables enable powerful, complex business insights.
These might be 5 most important KPIs for Omio (some of them are included to the final reporting):
1. Total Net Revenue (EUR): The core measure of financial performance.
2. Average Booking Value (ABV): Measures the average value per order, indicating efficiency and upsell success.
3. Revenue per Passenger: Tracks the total economic value generated by the average individual customer.
4. Booking Volume: The fundamental measure of market activity and total orders placed.
5. Cancellation Rate: A critical health metric tracking post-purchase satisfaction and operational stability.

